/*
 * (c) 2019 One Mind
 * 2019-01-20 7:15:14 PM
 */

var Charts=Charts||{};Charts={version:"46",generateCharts:function(t){var e=t.demographics,a=void 0===t.species?"human":t.species.toLowerCase(),r=e.map(function(t){return t.age}).filter(function(t){return null!=t}).sort(function(t,e){return t-e});r&&(this.insertContainer("ageTable","Age Stats"),this.draw.agesTable(r,a),this.insertContainer("ageHistogram","Age Histogram"),this.draw.agesHistogram(r,a),"rat"!==a&&"mouse"!==a||(this.insertContainer("ageCategoriesHistogram","Age Categories Histogram"),this.draw.agesCategoriesHistogram(r,a)));var o=e.filter(function(t){return null==t.sex&&(t.sex=""),"male"===t.sex.toLowerCase()||"m"===t.sex.toLowerCase()[0]}).length,n=e.filter(function(t){return"female"===t.sex.toLowerCase()||"f"===t.sex.toLowerCase()[0]}).length,i=e.filter(function(t){return"m"!==t.sex.toLowerCase()[0]&&"f"!==t.sex.toLowerCase()[0]}).length;0<o||0<n||0<i?(this.insertContainer("sexPieChart","Sex"),this.draw.sexPieChart(o,n,i)):this.removeContainer("sexPieChart");var s=e.filter(function(t){return null==t.race&&(t.race=""),-1!==t.race.toLowerCase().indexOf("white")}).length,l=e.filter(function(t){return-1!==t.race.toLowerCase().indexOf("black")||-1!==t.race.toLowerCase().indexOf("african")}).length,c=e.filter(function(t){return-1!==t.race.toLowerCase().indexOf("indian")||-1!==t.race.toLowerCase().indexOf("alaska")}).length,g=e.filter(function(t){return-1!==t.race.toLowerCase().indexOf("asian")}).length,h=e.filter(function(t){return-1!==t.race.toLowerCase().indexOf("hawaiian")||-1!==t.race.toLowerCase().indexOf("pacific")||-1!==t.race.toLowerCase().indexOf("islander")}).length,u=e.filter(function(t){return-1!==t.race.toLowerCase().indexOf("other")}).length;if(0<s||0<l||0<c||0<g||0<h||0<u?(this.insertContainer("racePieChart","Race"),this.draw.racePieChart(s,l,c,g,h,u)):this.removeContainer("racePieChart"),"human"===a){var d=e.filter(function(t){return t.cohort&&0<=t.cohort.length}).map(function(t){return t.cohort});d.length?(this.insertContainer("cohortsBarChart","Cohorts"),this.draw.cohortsBarChart(d)):this.removeContainer("cohortsBarChart");var f=e.filter(function(t){return t.gcs_arrival&&(0<=t.gcs_arrival.length||0<=t.gcs_arrival)}).map(function(t){return t.gcs_arrival});f.length?(this.insertContainer("GCSBarChart","GCS"),this.draw.GCSBarChart(f)):this.removeContainer("GCSBarChart")}$("#meta-data-charts-loading").remove()},clearAndShowLoading:function(){$.each($("#meta-data-charts > div"),function(t,e){$("#"+$(e).attr("id")).html('<i class="fa fa-spinner fa-pulse fa-fw"></i> Updating data...')})},insertContainer:function(t,e){$("#"+t).length?$("#"+t).html('<i class="fa fa-spinner fa-pulse fa-fw"></i> Loading '+e+" charts..."):$("#meta-data-charts").append('<div id="'+t+'" style="width:100%;"><i class="fa fa-spinner fa-pulse fa-fw"></i> Loading '+e+" charts...</div>")},removeContainer:function(t){$("#"+t).remove()},draw:{cohortsBarChart:function(t){var e=[],a={};t.forEach(function(t){var e="_"+t;null==a[e]?a[e]=0:a[e]++}),Object.keys(a).forEach(function(t){e.push([t.substring(1).toUpperCase()||"Unknown",a[t]])}),google.charts.load(Charts.version,{packages:["corechart"]}),google.charts.setOnLoadCallback(function(){var t=google.visualization.arrayToDataTable([["Score","Number of Subjects"]].concat(e));new google.visualization.ColumnChart(document.getElementById("cohortsBarChart")).draw(t,{title:"Cohorts",height:250,chartArea:{backgroundColor:"#F9F9F9"},colors:["1f7bba"],legend:{position:"none"},hAxis:{title:"Cohorts",logScale:!0},vAxis:{title:"# of Subjects"}})})},GCSBarChart:function(t){var e=[],a={_:0,_3:0,_4:0,_5:0,_6:0,_7:0,_8:0,_9:0,_10:0,_11:0,_12:0,_13:0,_14:0,_15:0};t.forEach(function(t){var e=isNaN(t)?"_":"_"+t;null==a[e]?a[e]=0:a[e]++}),Object.keys(a).sort(function(t,e){var a,r;return t.substring(1).match(/\d/g)&&e.substring(1).match(/\d/g)&&(a=e.match(/\d/g).join(""),r=t.match(/\d/g).join("")),r-a}).forEach(function(t){e.push([t.substring(1).toUpperCase()||"Unknown",a[t]])}),google.charts.load(Charts.version,{packages:["corechart"]}),google.charts.setOnLoadCallback(function(){var t=google.visualization.arrayToDataTable([["Score","Number of Subjects"]].concat(e));new google.visualization.ColumnChart(document.getElementById("GCSBarChart")).draw(t,{title:"GCS at Arrival",height:250,chartArea:{backgroundColor:"#F9F9F9"},colors:["1f7bba"],legend:{position:"none"},hAxis:{title:"GCS Scores",logScale:!0},vAxis:{title:"# of Subjects"}})})},sexPieChart:function(e,a,r){google.charts.load(Charts.version,{packages:["corechart"]}),google.charts.setOnLoadCallback(function(){var t=google.visualization.arrayToDataTable([["Sex","Totals"],["Male",e],["Female",a],["Not Provided",r]]);new google.visualization.PieChart(document.getElementById("sexPieChart")).draw(t,{title:"Subjects by Sex",colors:["#36A2EB","#FF6384","#dddddd"],legend:{position:"right"},height:250})})},racePieChart:function(e,a,r,o,n,i){google.charts.load(Charts.version,{packages:["corechart"]}),google.charts.setOnLoadCallback(function(){var t=google.visualization.arrayToDataTable([["Race","Totals"],["White American",e],["Black or African American",a],["Native American and Alaska Native",r],["Asian American",o],["Native Hawaiian and Other Pacific Islander",n],["some other race",i]]);new google.visualization.PieChart(document.getElementById("racePieChart")).draw(t,{title:"Subjects by Race",colors:["#E85842","#FF9F40","#5277FF","#4BC0C0","#9966FF","#dddddd"],legend:{position:"right"},height:250})})},agesHistogram:function(t,a){var r="years";"human"===(a=a.toLowerCase())?r="years":"mouse"!==a&&"rat"!==a||(r="days");var o=[];"human"===a&&(t=t.map(function(t){return 100<t?100:Math.floor(t)}).slice());for(var e=0,n=t.length;e<n;e++)isNaN(parseInt(t[e]))||o.push(["Subject #"+(e+1),Math.round(parseInt(t[e]))]);google.charts.load(Charts.version,{packages:["corechart"]}),google.charts.setOnLoadCallback(function(){var t=google.visualization.arrayToDataTable([["Subject","Age"]].concat(o)),e={height:250,chartArea:{backgroundColor:"#F9F9F9"},title:"Subjects by Age",legend:{position:"none"},colors:["1f7bba"],vAxis:{title:"Number of Subjects"},hAxis:{title:"Ages ("+r+")",slantedText:!1,ticks:"human"===a?[0,10,20,30,40,50,60,70,80,90,{v:100,f:"100+"}]:null},histogram:{minValue:0,maxValue:"human"===a?99:null,bucketSize:"human"===a?2:null}};new google.visualization.Histogram(document.getElementById("ageHistogram")).draw(t,e)})},agesCategoriesHistogram:function(t,e){e=e.toLowerCase();var a={human:{unit:"years",labelText:function(t){return this.category[t].from+"-"+this.category[t].to+" "+this.unit},category:{infant:{from:0,to:3},child:{from:3,to:12},adolescent:{from:12,to:20},young_adult:{from:20,to:35},middle_age:{from:35,to:65},older_adult:{from:65,to:110}}},rat:{unit:"days",labelText:function(t){return this.category[t].from+"-"+this.category[t].to+" "+this.unit},category:{infant:{from:20,to:24},child:{from:24,to:60},adolescent:{from:60,to:180},young_adult:{from:180,to:420},middle_age:{from:420,to:720},older_adult:{from:720,to:1350}}},mouse:{unit:"days",labelText:function(t){return this.category[t].from+"-"+this.category[t].to+" "+this.unit},category:{infant:{from:20,to:25},child:{from:25,to:35},adolescent:{from:35,to:90},young_adult:{from:90,to:180},middle_age:{from:180,to:420},older_adult:{from:420,to:1080}}}}[e],r=t.filter(function(t){return a.category.infant.from<=t&&t<a.category.infant.to}),o=t.filter(function(t){return a.category.child.from<=t&&t<a.category.child.to}),n=t.filter(function(t){return a.category.adolescent.from<=t&&t<a.category.adolescent.to}),i=t.filter(function(t){return a.category.young_adult.from<=t&&t<a.category.young_adult.to}),s=t.filter(function(t){return a.category.middle_age.from<=t&&t<a.category.middle_age.to}),l=t.filter(function(t){return a.category.older_adult.from<=t&&t<a.category.older_adult.to});google.charts.load(Charts.version,{packages:["corechart"]}),google.charts.setOnLoadCallback(function(){var t=google.visualization.arrayToDataTable([["Age Category","Number of Subjects",{role:"annotation"}],["Infant ",r.length,a.labelText("infant")],["Child",o.length,a.labelText("child")],["Adolescent",n.length,a.labelText("adolescent")],["Young Adult",i.length,a.labelText("young_adult")],["Middle Age",s.length,a.labelText("middle_age")],["Older Adult",l.length,a.labelText("older_adult")]]),e=new google.visualization.DataView(t);e.setColumns([0,1,{calc:"stringify",sourceColumn:1,type:"string",role:"annotationText"},2]);new google.visualization.BarChart(document.getElementById("ageCategoriesHistogram")).draw(e,{chartArea:{backgroundColor:"#F9F9F9"},annotations:{},title:"Subjects by Age Category",colors:["1f7bba"],hAxis:{title:"Number of Subjects",slantedText:!1},height:400,bar:{groupWidth:"95%"},legend:{position:"none"}})})},agesTable:function(t,e){var a=0,r=(t.reduce(function(t,e){return e?t+e:(a++,t)},0)/(t.length-a)).toFixed(2),o=t[Math.ceil((t.length-1)/2)],n=t[0],i=t[t.length-1],s="years";"human"===(e=e.toLowerCase())?s="years":"mouse"!==e&&"rat"!==e||(s="days");var l='<table class="table table-striped table-bordered"><thead><tr><th colspan="5">Age ('+s+") Stats</th></tr></thead><tbody><tr><td><strong>Average:</strong> "+(isNaN(r)?"N/A":r)+"</td><td><strong>Median:</strong> "+(isNaN(o)?"N/A":o)+"</td><td><strong>Youngest:</strong> "+(isNaN(n)?"N/A":n)+"</td><td><strong>Oldest:</strong> "+(isNaN(i)?"N/A":i)+"</td></tr></tbody></table>";$("#ageTable").html(l)}}};