/*
 * (c) 2018 One Mind
 * 2018-07-25 5:35:48 PM
 */

var OM=OM||{};OM.refresh={contacts:function(){$("#target_friends").length&&$.ajax({url:ONEMIND_HOME_CONTROLLER+"display_connections.load"}).done(function(t){$("#target_friends").html(t)})},notifications:function(){$("#notifications").length&&$.ajax({url:ONEMIND_HOME_CONTROLLER+"display_notifications.load"}).done(function(t){$("#notifications").html(t)})}},OM.post={add:function(n){var t=$("#user_post").mentionsInput("getValue"),e=$("#user_post_form");e.parsley().validate(),!0===e.parsley().isValid()?$.ajax({url:POST_URL,type:"POST",dataType:"json",data:{message:t}}).done(function(t){if("success"===t.status){$("#user_post").mentionsInput("clear"),$("#character-count").text($("#user_post").data("parsley-maxlength")),$("#add_post_button").prop("disabled",!1).text("Post"),$("#user_post").prop("disabled",!1),autosize.update(n),t.data.post.text=OM.mentions.parse(t.data.post.text),t.data.post.template_for_message=!0;var e=$("#post-entry-tmpl").html();Mustache.tags=["[[","]]"],Mustache.parse(e);var a=Mustache.render(e,t.data);$("#posts").prepend(a),OM.emoji.parse("post_"+t.data.post.id),OM.emoji.initAutocomplete("#user_post, .comment_textarea, .comment-section textarea"),OM.mentions.initAutocomplete("#post_"+t.data.post.id+" .comment_textarea")}else humane.log(t.message),$("#user_post").prop("disabled",!1),$("#add_post_button").prop("disabled",!1).text("Post")}).fail(function(){humane.log("Could not post update")}):($("#user_post").prop("disabled",!1),$("#add_post_button").prop("disabled",!1).text("Post"))},delete:function(t){bootbox.dialog({title:"Delete Post",message:"Post will be deleted permanently. Are you sure?",buttons:{cancel:{label:"Cancel",className:"btn-default",callback:function(){}},proceed:{label:"Delete",className:"btn-danger delete-post-confirm-btn",callback:function(){$(document).trigger("ga.deletePost"),$.ajax({url:DELETE_POST_URL,data:{id:t}}).done(function(){$("#post_"+t).closest(".post-wrapper").remove()})}}}})},share:function(t,e,n){var a="__share__:"+t+":"+e;bootbox.confirm("This post will be shared with all your connections. Are you sure?",function(t){t&&$.ajax({url:POST_URL,type:"POST",dataType:"json",data:{message:a,type:"share"}}).done(function(t){if("success"===t.status){if(humane.log("Successfully shared post!"),n.text("Shared").prop("disabled",!0).removeClass("btn-default"),$("#home").length){t.data.post.template_for_share=!0,t.data.post.metadata.package&&(t.data.post.template_for_share_of_package=!0);var e=$("#post-entry-tmpl").html();Mustache.tags=["[[","]]"],Mustache.parse(e);var a=Mustache.render(e,t.data);$("#posts").prepend(a),OM.mentions.initAutocomplete("#post_"+t.data.post.id+" .comment_textarea"),OM.emoji.initAutocomplete("#post_"+t.data.post.id+" .comment_textarea")}}else humane.log(t.message)}).fail(function(){humane.log("Error: Could not share post.")})})}},OM.comment={delete:function(t,n){bootbox.dialog({title:"Delete Comment",message:"Comment will be deleted permanently. Are you sure?",buttons:{cancel:{label:"Cancel",className:"btn-default",callback:function(){}},proceed:{label:"Delete",className:"btn-danger delete-comment-confirm-btn",callback:function(){$(document).trigger("ga.deleteComment"),$.ajax({url:DELETE_COMMENT_URL,data:{id:t}}).done(function(t){if("success"===t.status){var e=n.closest(".comments-container").find(".comment-count"),a=parseInt(e.text());1===a?(n.closest(".comments-container").find(".comments-counter-section").hide(),e.text("No Comments"),n.closest(".comments-container").find(".likes-counter-section").is(":visible")||n.closest(".comments-container").find(".post-stats-header").hide()):2===a?e.text("1 Comment"):e.text(a-1+" Comments"),n.closest(".comment").remove()}else humane.log(t.message)})}}}})},add:function(s,i,c,l){var t=i.mentionsInput("getValue");c.parsley().validate(),!0===c.parsley().isValid()?$.ajax({url:POST_COMMENT_URL,data:{post_text:t,post_id:s},dataType:"json"}).done(function(t){if("success"===t.status){var e=t.data,a='<li class="comment list-group-item"><div class="row"><div class="comment-author-avatar col-xs-1">    <img width="36" height="36" alt="'+e.author+'" src="'+e.author_avatar+'"></div><div class="col-xs-11">        <button data-post-id="'+e.id+'" aria-hidden="true" title="Delete Comment" class="delete-comment-button tooltipfy pull-right btn btn-link" type="button"><i class="fa fa-trash-o"></i></button>        <div class="comment-author-name">            <span>'+e.author+'</span>        </div>    <div class="comment-time">'+e.timestamp+'</div>    <div class="comment-text">'+OM.mentions.parse(e.content)+'</div>    <div class="comment-actions">            <button data-comment-id="'+e.id+'" class="like-comment-button btn btn-link">                Like            </button>            <span class="comment-likes-wrapper" style="display:none;">               <i class="fa fa-thumbs-up"></i> <span class="comment-likes-count">0</span>            </span>    </div></div></div></li>';c.closest(".comments-container").find(".comments").append(a);var n=c.closest(".comments-container").find(".comment-count"),o=parseInt(n.text());c.closest(".comments-container").find(".post-stats-header").show(),c.closest(".comments-container").find(".comments-counter-section").show(),isNaN(o)||0===o?n.text("1 Comment"):n.text(o+1+" Comments"),i.mentionsInput("clear"),c.find(".add-comment-button").prop("disabled",!1).text("Post"),autosize.update(l),OM.emoji.parse("posts"),OM.emoji.parse("post-widget")}else bootbox.alert("Post is no longer available"),$("#post_"+s).closest(".post-wrapper").remove()}):c.find(".add-comment-button").prop("disabled",!1).text("Post")}},OM.like={post:function(t,e){t.toggleClass("unlike-post-button like-post-button").text("Unlike");var a=t.closest(".post").find(".comments-container").find(".post-stats-header"),n=a.find(".likes-counter-section"),o=n.find(".likes-count"),s=parseInt(o.text());a.show(),n.show(),isNaN(s)||0===s?n.find(".like-text").html("You like this."):n.find(".like-text").html('You and <span class="likes-count">'+s+"</span> "+(1===s?"other":"others")+" like this."),$.ajax({url:LIKE_POST_ENDPOINT_URL,type:"POST",dataType:"json",data:{post_id:e}}).done(function(t){t.status})},undoPost:function(t,e){t.toggleClass("unlike-post-button like-post-button").text("Like");var a=t.closest(".post").find(".comments-container").find(".post-stats-header"),n=a.find(".likes-counter-section"),o=n.find(".likes-count"),s=parseInt(o.text());isNaN(s)?(n.hide(),a.find(".comments-counter-section").is(":visible")||a.hide()):1===s?n.find(".like-text").html('<span class="likes-count">'+s+"</span> person likes this."):n.find(".like-text").html('<span class="likes-count">'+s+"</span> people like this."),$.ajax({url:LIKE_POST_ENDPOINT_URL,type:"DELETE",dataType:"json",data:{post_id:e}}).done(function(t){t.status})},comment:function(n,t){n.toggleClass("unlike-comment-button like-comment-button"),n.text("Unlike");var e=n.closest(".comment-actions").find(".comment-likes-count"),a=parseInt(e.text());e.parent(".comment-likes-wrapper").show(),isNaN(a)?e.text("1"):e.text(a+1),$.ajax({url:LIKE_COMMENT_ENDPOINT_URL,type:"POST",dataType:"json",data:{comment_id:t}}).done(function(t){if("success"===t.status);else{n.toggleClass("unlike-comment-button like-comment-button"),n.text("Like");var e=n.closest(".comment-actions").find(".comment-likes-count"),a=parseInt(e.text());1===a?(e.text("0"),e.parent(".comment-likes-wrapper").hide()):(e.text(a-1),e.parent(".comment-likes-wrapper").show())}})},undoComment:function(n,t){n.toggleClass("unlike-comment-button like-comment-button"),n.text("Like");var e=n.closest(".comment-actions").find(".comment-likes-count"),a=parseInt(e.text());1===a?(e.text("0"),e.parent(".comment-likes-wrapper").hide()):e.text(a-1),$.ajax({url:LIKE_COMMENT_ENDPOINT_URL,type:"DELETE",dataType:"json",data:{comment_id:t}}).done(function(t){if("success"===t.status);else{n.toggleClass("unlike-comment-button like-comment-button"),n.text("Unlike");var e=n.closest(".comment-actions").find(".comment-likes-count"),a=parseInt(e.text());isNaN(a)?e.text("1"):e.text(a+1)}})}},OM.contact={connect:function(t){$.ajax({url:CONNECTIONS_ENDPOINT_URL,type:"POST",dataType:"json",data:{user_id:t}}).done(function(t){if("success"===t.status){if("connected"===t.data.status){if($("#home").length){t.data.post.template_for_connection=!0;var e={post:t.data.post},a=$("#post-entry-tmpl").html();Mustache.tags=["[[","]]"],Mustache.parse(a);var n=Mustache.render(a,e);$("#posts").prepend(n),OM.emoji.initAutocomplete("#post_"+t.data.post.id+" .comment_textarea"),OM.mentions.initAutocomplete("#post_"+t.data.post.id+" .comment_textarea"),OM.emoji.parse("posts")}OM.refresh.contacts()}OM.refresh.notifications()}humane.log(t.message)})},ignore:function(t){$.ajax({url:CONNECTIONS_ENDPOINT_URL,type:"PUT",dataType:"json",data:{user_id:t,status:"ignore"}}).done(function(t){"success"===t.status&&OM.refresh.notifications()})},remove:function(e){var t=e.data("user-id"),a=e.data("user-name");bootbox.dialog({message:"<strong>"+a+"</strong> will be removed from your contacts list. You will no longer be able to see each other's activity stream.",title:"Remove Contact",buttons:{cancel:{label:"Cancel",className:"btn-link",callback:function(){}},danger:{label:"Remove",className:"btn-danger",callback:function(){$.ajax({url:CONNECTIONS_ENDPOINT_URL,type:"DELETE",dataType:"json",data:{user_id:t}}).done(function(t){"success"===t.status?(e.hasClass("is-connected")&&e.removeClass("disconnect-contact-button is-connected").addClass("connect-contact-button").html('<i class="fa fa-user-plus"></i> Connect'),OM.refresh.contacts()):humane.log(t.message)})}}}})}},OM.loadingSpinnerUI={show:function(t){t=t||"",$("body").append('<div id="loading-spinner"><div class="spinner-text">'+t+"</div></div>").append('<div id="loading-spinner-backdrop"></div>');var e=document.getElementById("loading-spinner");new Spinner({lines:11,length:9,width:5,radius:13,corners:1,rotate:0,direction:1,color:"#F5B91C",speed:.9,trail:64,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"auto"}).spin(e)},hide:function(){$("#loading-spinner, #loading-spinner-backdrop").remove()}},OM.confirmModal={show:function(t){return!0===confirm(t||"Are you sure you want to proceed?")}},OM.emoji={initAutocomplete:function(t){$(t).textcomplete([{match:/\B:([\-+\w]*)$/,search:function(e,t){t($.map(emojies,function(t){return 0===t.indexOf(e)?t:null}))},template:function(t){return'<img src="'+S3_STATIC_DIR+"emojify/images/basic/"+encodeURIComponent(t)+'.png" height="20" width="20"></img> '+t},replace:function(t){return":"+t+": "},index:1}],{onKeydown:function(t,e){if(t.ctrlKey&&74===t.keyCode)return e.KEY_ENTER},maxCount:8})},parse:function(t){var e=document.getElementById(t);null!==e&&(emojify.setConfig({ignore_emoticons:!0,img_dir:S3_STATIC_DIR+"emojify/images/basic"}),emojify.run(e))}},OM.mentions={initAutocomplete:function(a){$.ajax({url:ONEMIND_API+"users/self/connections",dataType:"json"}).done(function(t){var e=[];"success"===t.status&&(e=$.map(t.data.connections,function(t){return{value:t.first_name+" "+t.last_name,uid:"user:"+t.id}})),$(a).mentionsInput({source:e,suffix:" "})})},parse:function(t){return t.replace(/@\[([^\[]*)\]\(user:(\d+)\)/g,'<a href="'+ONEMIND_PROFILE_CONTROLLER+'?id=$2" class="at-mention">@$1</a>')}},OM.utilities={getParameterByName:function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(location.search);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))}},$(function(){var t=$("#user_post"),a=$(".comment_textarea");autosize(t),autosize(a),$("#add_post_button").click(function(){$(this).prop("disabled",!0).text("Posting..."),$("#user_post").prop("disabled",!0),OM.post.add(t)}),$("#posts").on("click",".delete-post-button",function(t){t.preventDefault(),OM.post.delete($(this).data("id"))}),$("body").on("click",".share-post-button",function(){OM.post.share($(this).data("post-id"),$(this).data("post-author-id"),$(this))}),$("#user_post").on("keyup",function(){var t=$(this).data("parsley-maxlength")-$(this).val().length;t<=0?$("#post-character-info #character-count").text(t).css("color","#A94442"):$("#post-character-info #character-count").text(t).css("color","#999")}),$("body").on("click",".add-comment-button",function(){var t=$(this).closest("form"),e=t.find(".comment_textarea");t.find(".add-comment-button").prop("disabled",!0).text("Posting..."),OM.comment.add($(this).data("post-id"),e,t,a)}),$("body").on("click",".delete-comment-button",function(){OM.comment.delete($(this).data("post-id"),$(this))}),$("body").on("click",".like-post-button",function(){var t=$(this),e=t.data("post-id");OM.like.post(t,e)}),$("body").on("click",".unlike-post-button",function(){var t=$(this),e=t.data("post-id");OM.like.undoPost(t,e)}),$("body").on("click",".like-comment-button",function(){var t=$(this),e=t.data("comment-id");OM.like.comment(t,e)}),$("body").on("click",".unlike-comment-button",function(){var t=$(this),e=t.data("comment-id");OM.like.undoComment(t,e)}),$("#topbar .dropdown-menu").click(function(t){t.stopPropagation()}),$("#sign_in_menu").on("click",function(){setTimeout(function(){$("#auth_user_email").focus()},150)}),$(".tooltipfy").tooltip({container:"body"}),$("input, textarea").placeholder(),$("#signin_top").on("click",function(t){t.preventDefault();var e=$(this).closest("form");if($("#auth_user_email").val($.trim($("#auth_user_email").val())),e.parsley().validate(),!0!==e.parsley().isValid())return!1;e.submit()}),$("body").on("click",".connect-contact-button",function(t){t.preventDefault(),t.stopPropagation(),$(this).prop("disabled",!0),OM.contact.connect($(this).data("user-id"))}),$("body").on("click",".disconnect-contact-button",function(t){t.preventDefault(),t.stopPropagation(),OM.contact.remove($(this))}),$("body").on("mouseover",".is-connected",function(){$(this).html("Disconnect")}).on("mouseout",".is-connected",function(){$(this).html('<i class="fa fa-check"></i> Connected')}),$("body").on("click",".ignore-contact-button",function(t){t.preventDefault(),t.stopPropagation(),$(this).prop("disabled",!0),OM.contact.ignore($(this).data("user-id"))}),$("#dashboard-menu").on("click",function(t){t.preventDefault(),$("#dashboard-dropdown-container").length?$("#dashboard-dropdown-container").toggle().focus():($(this).after('<div id="dashboard-dropdown-container"><div id="dashboard-dropdown-body"><i class="fa fa-spinner fa-spin"></i> Loading...</div><div id="dashboard-dropdown-footer"><a href="'+ONEMIND_DASHBOARD_CONTROLLER+'"><i class="fa fa-th-large" aria-hidden="true"></i> More</a></div></div>'),$("#dashboard-dropdown-container").prop("tabindex",-1).focus(),$("#dashboard-dropdown-container").on("focusout",function(){var t=$(this);setTimeout(function(){t.hide()},150)}),$.ajax({url:ONEMIND_API+"catalog/dashboard",dataType:"json",data:{show:"recent"}}).done(function(t){if("success"===t.status)if(0<t.data.length){var a=$("<ul></ul>");$.each(t.data,function(t,e){("public"===e.package.share_type||"locked"===e.package.share_type&&"unlocked"===e.user_package.unlock_status)&&a.append('<li><a href="'+ONEMIND_CATALOG_CONTROLLER+"package/"+e.package.id+"/"+e.package.name_slug+'/posts" title="'+e.package.name+'"><img src="'+e.package.image+'" alt="" height="60" width="60" /> <span>'+e.package.name+"</span></a></li>")}),$("#dashboard-dropdown-body").html(a)}else $("#dashboard-dropdown-body").html('<p class="text-center text-muted">You haven\'t joined any groups. Browse the <a href="'+ONEMIND_CATALOG_CONTROLLER+'">Catalog</a> to find groups to join!</p>')}))}),$(document).on("click",".install-package-button",function(){var e,a,t=$(this),n=t.data("package-id"),o=null,s=null;function i(){$(".dialog, .modal").modal("hide"),OM.loadingSpinnerUI.show("Loading"),$.ajax({url:INSTALL_PACKAGE_URL,data:{id:n}}).done(function(t){"false"!==t?($(document).trigger("ga.packageInstalled",[e]),window.location.href=ONEMIND_CATALOG_CONTROLLER+"package/"+n+"/"+a):(humane.timeout=3e3,humane.log('<p><i class="fa fa-exclamation-triangle"></i> Error: Unable to join the group!</p>'))}).fail(function(){OM.loadingSpinnerUI.hide(),humane.timeout=3e3,humane.log('<p><i class="fa fa-exclamation-triangle"></i> Error: Unable to join the group!</p>')})}$(this).prop("disabled",!0),"undefined"==typeof ONEMIND_MY_PROFILE_ID&&(window.location.href=ONEMIND_ROOT_URL+"/user/login"),$.ajax({url:ONEMIND_API+"catalog/packages/"+n,dataType:"json",data:{fields:"name,terms,slug"}}).done(function(t){"success"===t.status&&(e=t.data.name,a=t.data.slug,o=t.data.terms,"text"===t.data.terms.type?o=t.data.terms.content:"external_link"===t.data.terms.type&&(s=t.data.terms.content))}).then(function(){return $.ajax({url:ONEMIND_ROOT_URL+"/static/terms/end_user_terms.html"})}).done(function(t){bootbox.dialog({message:t,title:"One Mind Catalog - Terms and Conditions",buttons:{main:{label:"Don't Agree",className:"btn-link",callback:function(){}},success:{label:"I Agree to the Terms and Conditions",className:"btn-primary",callback:function(){s?bootbox.dialog({message:'<iframe sandbox style="width:100%;border: 0; height: 330px;" src="'+s+'"></iframe> <div class="text-center"><i class="fa fa-link" aria-hidden="true"></i> <a href="'+s+'" rel="nofollow" target="_blank">Open in new window</a></div>',title:'<span class="package-name">'+e+"</span> - Terms and Conditions",buttons:{main:{label:"Don't Agree",className:"btn-link",callback:function(){}},success:{label:"I Agree to the Terms and Conditions",className:"btn-primary confirm-install",callback:i}},className:"package-terms-modal",backdrop:"static"}):o?bootbox.dialog({message:o,title:'<span class="package-name">'+e+"</span> - Terms and Conditions",buttons:{main:{label:"Don't Agree",className:"btn-link",callback:function(){}},success:{label:"I Agree to the Terms and Conditions",className:"btn-primary confirm-install",callback:i}},className:"package-terms-modal",backdrop:"static"}):bootbox.dialog({message:"No terms or conditions are imposed for the package by the publisher.",title:'<span class="package-name">'+e+"</span> - Terms and Conditions",buttons:{main:{label:"Cancel",className:"btn-link",callback:function(){}},success:{label:"Continue",className:"btn-primary confirm-install",callback:i}},className:"package-terms-modal",backdrop:"static"})}}},className:"terms-modal",backdrop:"static"})}).always(function(){t.prop("disabled",!1)})}),$("body").on("click",".uninstall-package-button",function(t){t.stopPropagation();var o=$(this).data("package-id");$.ajax({url:ONEMIND_API+"catalog/packages/"+o,data:{fields:"access,name"},dataType:"json"}).done(function(t){var e=t.data.access,a=t.data.name,n="";"unlocked"===e?n="Leaving group will revoke your access to it. ":"pending"===e&&(n="Leaving group will cancel your access request. "),bootbox.dialog({title:'<i class="fa fa-trash"></i> Leave Group',message:n+'Are you sure you want to leave the group for <strong class="package-name">'+a+"</strong>?",buttons:{main:{label:"Cancel",className:"btn-link",callback:function(){}},success:{label:"Continue",className:"btn-danger confirm-uninstall",callback:function(){OM.loadingSpinnerUI.show("Loading"),$.ajax({url:UNINSTALL_REMOVE_PACKAGE_URL,dataType:"json",data:{id:o}}).done(function(t){1===t?($(document).trigger("ga.packageUninstalled",[a]),location.reload()):(OM.loadingSpinnerUI.hide(),humane.log("Warning: Uninstall unsuccessful, package is not installed."))}).fail(function(){OM.loadingSpinnerUI.hide(),humane.log("Warning: Uninstall unsuccessful")})}}}})})}),$(document).on("click",".portal-exit-notice",function(t){t.preventDefault();var e=$(this).attr("href");bootbox.dialog({title:"You are now leaving the Portal...",message:"The data is hosted elsewhere on <b>"+e+"</b> and One Mind does not control or actively monitors this resource.",buttons:{cancel:{label:"Cancel",className:"btn-default pull-left"},launch:{label:"Proceed",className:"btn-primary",callback:function(){window.location=e}}}})}),$(document).on("mouseenter",".profile-tooltip",function(){$(this).qtip({content:{text:function(t,r){var d=parseInt(r.elements.target.attr("data-user-id"));return $.when($.ajax({url:ONEMIND_API+"users/self/profile",type:"GET",dataType:"json"}),$.ajax({url:ONEMIND_API+"users/"+d+"/profile",type:"GET",dataType:"json"})).then(function(t,e){var a,n,o,s=t[0].data.friends,i=e[0],c=i.data,l="";"success"===i.status?(1===c.friends.filter(function(t){return t.id===ONEMIND_MY_PROFILE_ID}).length,l+='<div class="profile-tooltip-container">',l+='<div class="profile-tooltip-content">',l+='<a href="'+ONEMIND_ROOT_URL+"/profile?id="+c.id+'" class="pull-left"><img src="'+c.image_url+'" height="80" width="80" /></a>',l+='<div class="pull-left">',l+='<a href="'+ONEMIND_ROOT_URL+"/profile?id="+c.id+'" class="name">'+c.first_name+" "+c.last_name+"</a>",l+=c.organization?'<div class="organization"><i class="fa fa-briefcase fa-fw"></i> '+c.organization+"</div>":"",l+=c.location&&!c.organization?'<div class="location"><i class="fa fa-map-marker fa-fw"></i> '+c.location+"</div>":"",l+=c.location||c.organization?"":'<div class="email"><i class="fa fa-envelope fa-fw"></i> '+c.email+"</div>",a=$.map(s,function(t){return t.id}),n=$.map(c.friends,function(t){return t.id}),o=$(a).filter(n),l+='<div class="connections"><i class="fa fa-users fa-fw"></i> '+c.friends.length+" "+(1===c.friends.length?"Connection":"Connections")+" ("+o.length+" Mutual)</div>",c.friends.length&&(l+='<ul class="connection-list">',$.each(c.friends,function(t,e){if(!(t<4))return l+='<li class="plus-connection">',l+='<a href="'+ONEMIND_ROOT_URL+"/profile/connections?id="+c.id+'">+'+(c.friends.length-4)+"</a>",l+="</li>",!1;l+="<li>",l+='<a href="'+ONEMIND_ROOT_URL+"/profile?id="+e.id+'">',l+='<img src="'+e.thumbnail+'" alt="'+e.first_name+" "+e.last_name+'" title="'+e.first_name+" "+e.last_name+'" height="30" width="30" />',l+="</a>",l+="</li>"}),l+="</ul>"),l+="</div>",l+="</div>",d!==ONEMIND_MY_PROFILE_ID&&(l+='<div class="profile-tooltip-footer" style="text-align:center">',l+='<button data-recipient-id="'+c.id+'" class="btn btn-default compose-btn btn-sm"><i class="fa fa-pencil-square-o"></i> Message</button> ',l+="</div>"),l+="</div>",r.set("content.text",l)):r.set("content.text",i.message)},function(){r.set("content.text","Whoops! Could not load profile information.")}),"Loading..."}},overwrite:!1,style:{classes:"qtip-light qtip-shadow",width:"400px"},show:{delay:250,ready:!0},hide:{fixed:!0,delay:300},position:{my:"bottom center",at:"top center",viewport:$(window)}})});var n=0;$("body").append('<div class="to-top-button" style="display:none;"><i class="fa fa-arrow-up"></i> Back to Top</div>'),$(window).on("scroll",function(){var t=$("#topbar"),e=$(this).scrollTop();if($(".dropdown").hasClass("open"))return!1;e<n||e<=50?t.fadeIn(400,function(){n=e}):t.fadeOut(400,function(){n=e})}),$(window).on("scroll",function(){800<=$(this).scrollTop()?$(".to-top-button").fadeIn():$(".to-top-button").fadeOut()}),$(".to-top-button").on("click",function(){$("html, body").animate({scrollTop:0},"slow")}),$("body").on("click",".add-package-post-comment",function(t){t.preventDefault();var l=$(this),e=l.data("post-id"),a=$("#comment-"+e),n=a.mentionsInput("getValue");if(a.parsley().validate(),!1===a.parsley().isValid())return!1;$(this).prop("disabled",!0).text("Posting..."),$.ajax({url:PACKAGE_CREATE_POST_COMMENT,dataType:"json",data:{package_comment_id:e,comment_reply:n}}).done(function(t){if(l.prop("disabled",!1).text("Post"),"success"===t.status){var e=t.data,a=moment(e.posted_at).fromNow();if($("#package-post-page").length)location.reload();else{l.closest(".comments-container").find(".comments-counter-section").show(),l.closest(".comments-container").find(".post-stats-header").show(),l.closest(".post").find(".comment-section textarea").mentionsInput("clear");var n=$('<li class="list-group-item comment" />'),o=$('<div class="row" />'),s=$('<div class="col-xs-1" style="width: 40px; padding: 5px 10px;" />'),i=$('<div class="col-xs-11" />');s.append('<img src="'+e.author.avatar_url+'" class="comment-author-avatar pull-left" height="36" width="36" alt="'+e.author.name+'" />'),i.append("<strong>"+e.author.name+"</strong>"),i.append('<div class="comment-date text-muted">'+a+"</div>"),i.append('<div class="comment-text">'+OM.mentions.parse(e.reply_text)+"</div>"),o.append(s,i),n.append(o),l.closest(".post").find(".comments").append(n);var c=l.closest(".post").find(".comment-count").text();l.closest(".post").find(".comment-count").text(parseInt(c)+1+" Comments"),$("#package-post-area").length?OM.emoji.parse("package-post-area"):OM.emoji.parse("posts")}}else humane.log(t.message)}).fail(function(){})})}),$("#people-search").length&&($("#people-search").autocomplete({source:ONEMIND_API+"search.json",minLength:3,delay:500,create:function(){var t=$('<div id="people-search-container" style="position:relative;" />'),e=$('<div id="people-search-spinner"><i class="fa fa-spinner fa-spin fa-fw"></i></div>').css({display:"none",position:"absolute",top:"7px",right:"5px"}),a=$('<div id="people-search-no-results">No results found!</div>').css({display:"none",background:"#333",width:"100%",position:"absolute",color:"#999",padding:"10px","z-index":2});$(this).after(t),t.append($(this),e,a),$(this).on("blur",function(){$("#people-search-no-results").hide()})},search:function(){$("#people-search-spinner").show()},response:function(t,e){$("#people-search-spinner").hide(),0===e.content.length?$("#people-search-no-results").show():$("#people-search-no-results").hide()}}).data("ui-autocomplete")._renderItem=function(t,e){var a=ONEMIND_PROFILE_CONTROLLER+"?id="+e.id,n="";return e.connected||(n='<button class="connect-contact-button btn btn-default btn-xs" data-user-id="'+e.id+'" title="Connect"><i class="fa fa-user-plus"></i></button>'),$('<li class="clearfix">').append('<a href="'+a+'"><img src="'+e.thumbnail+'" alt="'+e.first_name+" "+e.last_name+'" height="36" width="36" /><span class="complete-name">'+e.first_name+" "+e.last_name+"</span>"+n+"</a>").appendTo(t)});